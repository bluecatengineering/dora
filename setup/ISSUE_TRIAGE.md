# Automated Issue Triage with Claude

This workflow automatically analyzes new GitHub issues using Claude AI (Anthropic) and provides intelligent triage suggestions.

## Features

- **Automatic Analysis**: Claude analyzes new issues when they're opened
- **Smart Labeling**: Automatically applies relevant labels based on issue content
- **Priority Assessment**: Classifies issues by priority (critical, high, medium, low)
- **Detailed Comments**: Posts a structured analysis as a comment on the issue
- **Audit Trail**: Saves triage results as artifacts for review

## Quick Setup

Run the automated setup script:

```bash
./setup/setup-issue-triage.sh
```

This script will:
1. Create all necessary labels in your repository
2. Help you configure the Anthropic API key
3. Verify the workflow file is in place

## Manual Setup

### 1. Get an Anthropic API Key

1. Go to [Anthropic Console](https://console.anthropic.com/)
2. Sign up or log in
3. Navigate to API Keys
4. Create a new API key

### 2. Add API Key to GitHub Secrets

1. Go to your repository settings
2. Navigate to: **Settings** â†’ **Secrets and variables** â†’ **Actions**
3. Click **New repository secret**
4. Name: `ANTHROPIC_API_KEY`
5. Value: Your Anthropic API key
6. Click **Add secret**

### 3. Create Labels (Optional but Recommended)

The workflow uses these standard labels:

**Type Labels:**
- `bug` - Something isn't working
- `enhancement` - Improvement to existing feature
- `feature` - New feature request
- `documentation` - Documentation improvements
- `question` - Further information requested
- `help-wanted` - Extra attention needed
- `good-first-issue` - Good for newcomers

**Category Labels:**
- `performance` - Performance-related issues
- `security` - Security-related issues
- `dependencies` - Dependency updates
- `breaking-change` - Breaking changes
- `needs-investigation` - Requires further investigation

**Priority Labels:**
- `priority:critical` - Critical priority
- `priority:high` - High priority
- `priority:medium` - Medium priority
- `priority:low` - Low priority

You can create these manually or use the setup script.

### 4. Deploy the Workflow

The workflow file is already created at `.github/workflows/issue-triage.yml`

Commit and push it:

```bash
git add .github/workflows/issue-triage.yml
git commit -m "Add automated issue triage workflow"
git push
```

## How It Works

### Trigger

The workflow runs automatically when a new issue is opened:

```yaml
on:
  issues:
    types: [opened]
```

### Process Flow

1. **Issue Opened**: A user creates a new issue
2. **Checkout**: Workflow checks out the repository
3. **Claude Analysis**: Sends issue title and body to Claude Sonnet 4.5
4. **Structured Response**: Claude provides:
   - Summary (1-2 sentences)
   - Suggested labels
   - Priority assessment
   - Detailed analysis with next steps
5. **Comment Posted**: Analysis is posted as a comment on the issue
6. **Labels Applied**: Matching labels are automatically added
7. **Artifact Saved**: Triage result saved for 30 days

### Example Output

When a new issue is opened, Claude will comment with:

```markdown
## ðŸ¤– Automated Issue Triage

SUMMARY: User reports compilation error when building on ARM64
architecture with Rust 1.91.

LABELS: bug, needs-investigation, performance

PRIORITY: high

ANALYSIS: This issue describes a platform-specific compilation
failure on ARM64 systems. The error appears to be related to
platform-specific dependencies or compiler flags.

Impact: Blocks users on ARM64 platforms from building the project.

Suggested next steps:
1. Reproduce the issue on an ARM64 system
2. Check Cargo.toml for platform-specific dependencies
3. Review compilation flags and features for ARM64 compatibility
4. Add ARM64 to CI/CD pipeline for early detection

---
*This analysis was generated by Claude AI. Please review and
adjust labels/priority as needed.*
```

## Configuration

### Customize Labels

Edit the prompt in `.github/workflows/issue-triage.yml` to change available labels:

```javascript
LABELS: [comma-separated list of applicable labels from:
  bug, enhancement, feature, documentation, question,
  help-wanted, good-first-issue, performance, security,
  dependencies, breaking-change, needs-investigation]
```

### Customize Prompt

Modify the prompt in the workflow to adjust Claude's analysis style:

```javascript
const prompt = `You are a helpful GitHub issue triage assistant...`;
```

### Change Model

To use a different Claude model, update the model parameter:

```javascript
model: 'claude-sonnet-4-5-20250929',  // Current model
```

Available models:
- `claude-sonnet-4-5-20250929` (recommended)
- `claude-opus-4-5-20250514`
- `claude-haiku-3-5-20241022`

## Testing

### Test the Workflow

1. Create a test issue in your repository
2. The workflow should trigger automatically
3. Check the **Actions** tab to see the workflow run
4. Verify Claude's comment appears on the issue
5. Check that labels were applied correctly

### View Workflow Runs

1. Go to your repository
2. Click the **Actions** tab
3. Select **Issue Triage with Claude**
4. View individual workflow runs and logs

### Download Triage Results

Each workflow run saves a `triage-result` artifact containing the full analysis. To download:

1. Go to the workflow run
2. Scroll to **Artifacts**
3. Download `triage-result`

## Troubleshooting

### Workflow doesn't trigger

- Check that the workflow file is committed to the `main` or default branch
- Verify the file path: `.github/workflows/issue-triage.yml`
- Check Actions are enabled: **Settings** â†’ **Actions** â†’ **General**

### API key errors

```
Error: Anthropic API error: 401
```

- Verify `ANTHROPIC_API_KEY` is set in repository secrets
- Check the API key is valid and active
- Ensure there's no whitespace in the secret value

### Labels not applied

- Check that the labels exist in your repository
- The workflow only applies labels that already exist
- Run the setup script to create standard labels

### Permission errors

```
Error: Resource not accessible by integration
```

- Verify workflow permissions in `.github/workflows/issue-triage.yml`:
  ```yaml
  permissions:
    issues: write
    contents: read
  ```

## Cost Considerations

- Claude Sonnet 4.5 pricing: ~$3 per million input tokens, ~$15 per million output tokens
- Average issue triage: ~500 input tokens + ~300 output tokens
- Estimated cost per issue: ~$0.006 (less than a penny)
- For 100 issues/month: ~$0.60

The workflow is very cost-effective for most repositories.

## Privacy & Security

- Issue content is sent to Anthropic's API for analysis
- Ensure your repository's issues don't contain sensitive information
- API key is stored securely in GitHub Secrets
- The workflow only has read access to repository contents
- Write access is limited to issues only

## Customization Ideas

### Add Assignment

Automatically assign issues to team members based on category:

```javascript
if (suggestedLabels.includes('documentation')) {
  await github.rest.issues.addAssignees({
    owner: context.repo.owner,
    repo: context.repo.repo,
    issue_number: issueNumber,
    assignees: ['doc-team-member']
  });
}
```

### Add to Project Boards

Automatically add triaged issues to project boards:

```javascript
await github.rest.projects.createCard({
  column_id: COLUMN_ID,
  content_id: issue.id,
  content_type: 'Issue'
});
```

### Notify on Critical Issues

Send notifications for critical priority issues:

```javascript
if (priority === 'critical') {
  // Send Slack notification, email, etc.
}
```

## Maintenance

### Update Claude Model

When new Claude models are released, update the model parameter:

```javascript
model: 'claude-sonnet-4-5-20250929',
```

### Review Triage Accuracy

Periodically review the triage artifacts to ensure Claude is providing accurate analysis:

1. Download recent triage results
2. Compare with actual issue resolution
3. Adjust the prompt if needed

## Uninstalling

To remove the workflow:

```bash
git rm .github/workflows/issue-triage.yml
git commit -m "Remove issue triage workflow"
git push
```

To remove the API key:

1. Go to **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. Click the trash icon next to `ANTHROPIC_API_KEY`

## Support

For issues with:
- **The workflow**: Check workflow run logs in the Actions tab
- **Claude API**: See [Anthropic documentation](https://docs.anthropic.com/)
- **GitHub Actions**: See [GitHub Actions documentation](https://docs.github.com/en/actions)

## References

- Based on workflow from: [greenpdx/LnxNetCtl](https://github.com/greenpdx/LnxNetCtl)
- [Anthropic API Documentation](https://docs.anthropic.com/en/api/)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Claude Models](https://docs.anthropic.com/en/docs/models-overview)
